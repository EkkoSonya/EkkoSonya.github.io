"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[6827],{83671:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}},66386:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>i,data:()=>u});var t=a(7847);const e=a.p+"assets/img/63.0eede5c2.png",p=(0,t.Fv)('<h2 id="内容" tabindex="-1"><a class="header-anchor" href="#内容"><span>内容</span></a></h2><ul><li>Spring Task</li><li>订单状态定时处理</li><li>WebSocket</li><li>来单提醒</li><li>客户催单</li></ul><p>功能实现：<strong>订单状态定时处理</strong>、<strong>来单提醒</strong>和<strong>客户催单</strong></p><h2 id="spring-task" tabindex="-1"><a class="header-anchor" href="#spring-task"><span>Spring Task</span></a></h2><p><strong>Spring Task</strong> 是Spring框架提供的任务调度工具，可以按照约定的时间自动执行某个代码逻辑</p><p><strong>定位</strong>：定时任务框架</p><p><strong>作用</strong>：定时自动执行某段Java代码</p><h3 id="应用场景" tabindex="-1"><a class="header-anchor" href="#应用场景"><span>应用场景</span></a></h3><p>1). 信用卡每月还款提醒</p><p>2). 银行贷款每月还款提醒</p><p>3). 火车票售票系统处理未支付订单</p><p>4). 入职纪念日为用户发送通知</p><p><strong>强调</strong>：只要是需要定时处理的场景都可以使用Spring Task</p><h3 id="cron表达式" tabindex="-1"><a class="header-anchor" href="#cron表达式"><span>cron表达式</span></a></h3><p><strong>cron表达式</strong>其实就是一个字符串，通过cron表达式可以<strong>定义任务触发的时间</strong></p><p>**构成规则：**分为6或7个域，由空格分隔开，每个域代表一个含义</p><p>每个域的含义分别为：秒、分钟、小时、日、月、周、年(可选)</p><figure><img src="'+e+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><p><strong>举例</strong>：</p><p>2022年10月12日上午9点整 对应的cron表达式为：<strong>0 0 9 12 10 ? 2022</strong></p><p><strong>说明</strong>：一般<strong>日</strong>和<strong>周</strong>的值不同时设置，其中一个设置，另一个用？表示。</p><p><strong>比如</strong>：描述2月份的最后一天，最后一天具体是几号呢？可能是28号，也有可能是29号，所以就不能写具体数字。</p><p>为了描述这些信息，提供一些特殊的字符。这些具体的细节，我们就不用自己去手写，因为这个cron表达式，它其实有在线生成器。</p>',23),o={href:"https://cron.qqe2.com/",target:"_blank",rel:"noopener noreferrer"},c=(0,t.Fv)('<h4 id="通配符" tabindex="-1"><a class="header-anchor" href="#通配符"><span>通配符</span></a></h4><ul><li><p><code>*</code> 表示所有值</p></li><li><p><code>?</code> 表示未说明的值，即不关心它为何值</p></li><li><p><code>-</code> 表示一个指定的范围</p></li><li><p><code>,</code> 表示附加一个可能值</p></li><li><p><code>/</code> 符号前表示开始时间，符号后表示每次递增的</p></li></ul><h4 id="cron表达式案例" tabindex="-1"><a class="header-anchor" href="#cron表达式案例"><span>cron表达式案例</span></a></h4><ul><li><p><code>23 0 0/1 L * ? *</code> 本月最后一天从0小时开始, 每一小时执行一次</p></li><li><p><code>*/5 * * * * ?</code> 每隔5秒执行一次</p></li><li><p><code>0 */1 * * * ?</code> 每隔1分钟执行一次</p></li><li><p><code>0 0 5-15 * * ?</code> 每天5-15点整点触发</p></li><li><p><code>0 0/3 * * * ?</code> 每三分钟触发一次</p></li><li><p><code>0 0-5 14 * * ?</code> 在每天下午2点到下午2:05期间的每1分钟触发</p></li><li><p><code>0 0/5 14 * * ?</code> 在每天下午2点到下午2:55期间的每5分钟触发</p></li><li><p><code>0 0/5 14,18 * * ?</code> 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</p></li><li><p><code>0 0/30 9-17 * * ?</code> 朝九晚五工作时间内每半小时</p></li><li><p><code>0 0 10,14,16 * * ?</code> 每天上午10点，下午2点，4点</p></li></ul><h3 id="简单示例" tabindex="-1"><a class="header-anchor" href="#简单示例"><span>简单示例</span></a></h3><h4 id="_1-导入maven坐标-spring-context" tabindex="-1"><a class="header-anchor" href="#_1-导入maven坐标-spring-context"><span>1. 导入<code>maven</code>坐标 <code>spring-context</code></span></a></h4><h4 id="_2-启动类添加注解开启任务调度-enablescheduling" tabindex="-1"><a class="header-anchor" href="#_2-启动类添加注解开启任务调度-enablescheduling"><span>2. 启动类添加注解开启任务调度 <code>@EnableScheduling</code></span></a></h4><h4 id="_3-自定义定时任务类-scheduled" tabindex="-1"><a class="header-anchor" href="#_3-自定义定时任务类-scheduled"><span>3.自定义定时任务类 <code>@Scheduled</code></span></a></h4><p>对应方法没有返回值，且名字随意</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 自定义定时任务类\n */</span>\n<span class="token annotation punctuation">@Component</span>\n<span class="token annotation punctuation">@Slf4j</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token punctuation">{</span>\n\n    <span class="token doc-comment comment">/**\n     * 定时任务 每隔5秒触发一次\n     */</span>\n    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0/5 * * * * ?&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;定时任务开始执行：{}&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="订单状态定时处理" tabindex="-1"><a class="header-anchor" href="#订单状态定时处理"><span>订单状态定时处理</span></a></h2><h3 id="需求分析" tabindex="-1"><a class="header-anchor" href="#需求分析"><span>需求分析</span></a></h3><p>用户下单后可能存在的情况：</p><ul><li>下单后未支付，订单一直处于<strong>待支付</strong>状态</li><li>用户收货后管理端未点击完成按钮，订单一直处于<strong>派送中</strong>状态</li></ul><p>对于上面两种情况需要通过<strong>定时任务</strong>来修改订单状态，具体逻辑为：</p><ul><li>通过定时任务每分钟检查一次是否存在支付超时订单（下单后超过15分钟仍未支付则判定为支付超时订单），如果存在则修改订单状态为“已取消”</li><li>通过定时任务每天凌晨1点检查一次是否存在“派送中”的订单，如果存在则修改订单状态为“已完成”</li></ul><h3 id="代码开发" tabindex="-1"><a class="header-anchor" href="#代码开发"><span>代码开发</span></a></h3><p>自定义定时任务类<code>OrderTask</code></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>\n<span class="token annotation punctuation">@Slf4j</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderTask</span> <span class="token punctuation">{</span>\n    <span class="token annotation punctuation">@Autowired</span>\n    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>\n\n    <span class="token doc-comment comment">/**\n     * 处理支付超时订单\n     */</span>\n    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0 * * * * ?&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processTimeoutOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;处理支付超时订单：{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token class-name">LocalDateTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// select * from orders where status = 1 and order_time &lt; 当前时间-15分钟</span>\n        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Orders</span><span class="token punctuation">&gt;</span></span> ordersList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getByStatusAndOrderTimeLT</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">PENDING_PAYMENT</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span>ordersList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ordersList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            ordersList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>order <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>\n                order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">CANCELLED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                order<span class="token punctuation">.</span><span class="token function">setCancelReason</span><span class="token punctuation">(</span><span class="token string">&quot;支付超时，自动取消&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                order<span class="token punctuation">.</span><span class="token function">setCancelTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                orderMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token doc-comment comment">/**\n     * 处理“派送中”状态的订单\n     */</span>\n    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0 0 1 * * ?&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processDeliveryOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;处理派送中订单：{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// select * from orders where status = 4 and order_time &lt; 当前时间-1小时</span>\n        <span class="token class-name">LocalDateTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Orders</span><span class="token punctuation">&gt;</span></span> ordersList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getByStatusAndOrderTimeLT</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">DELIVERY_IN_PROGRESS</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span><span class="token punctuation">(</span>ordersList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ordersList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            ordersList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>order <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>\n                order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                orderMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在OrderMapper接口中扩展方法:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 根据状态和下单时间查询订单\n * <span class="token keyword">@param</span> <span class="token parameter">status</span>\n * <span class="token keyword">@param</span> <span class="token parameter">orderTime</span>\n */</span>\n<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from orders where status = #{status} and order_time &lt; #{orderTime}&quot;</span><span class="token punctuation">)</span>\n<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Orders</span><span class="token punctuation">&gt;</span></span> <span class="token function">getByStatusAndOrdertimeLT</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> status<span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span> orderTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',21),l={},i=(0,a(83671).A)(l,[["render",function(n,s){const a=(0,t.g2)("ExternalLinkIcon");return(0,t.uX)(),(0,t.CE)("div",null,[p,(0,t.Lk)("p",null,[(0,t.eW)("cron表达式在线生成器："),(0,t.Lk)("a",o,[(0,t.eW)("https://cron.qqe2.com/"),(0,t.bF)(a)])]),c])}]]),u=JSON.parse('{"path":"/code/java_item/1-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/article16.html","title":"Javassm - item1-16 (订单定时 来单提醒 客户催单 1)","lang":"zh-CN","frontmatter":{"title":"Javassm - item1-16 (订单定时 来单提醒 客户催单 1)","date":"2025-11-21T00:00:00.000Z","category":["code"],"tag":["java_item"],"order":-0.6,"description":"内容 Spring Task 订单状态定时处理 WebSocket 来单提醒 客户催单 功能实现：订单状态定时处理、来单提醒和客户催单 Spring Task Spring Task 是Spring框架提供的任务调度工具，可以按照约定的时间自动执行某个代码逻辑 定位：定时任务框架 作用：定时自动执行某段Java代码 应用场景 1). 信用卡每月还款提醒...","head":[["meta",{"property":"og:url","content":"http://ekkosonya.cn/code/java_item/1-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/article16.html"}],["meta",{"property":"og:site_name","content":"EkkoSonya\'s Blog"}],["meta",{"property":"og:title","content":"Javassm - item1-16 (订单定时 来单提醒 客户催单 1)"}],["meta",{"property":"og:description","content":"内容 Spring Task 订单状态定时处理 WebSocket 来单提醒 客户催单 功能实现：订单状态定时处理、来单提醒和客户催单 Spring Task Spring Task 是Spring框架提供的任务调度工具，可以按照约定的时间自动执行某个代码逻辑 定位：定时任务框架 作用：定时自动执行某段Java代码 应用场景 1). 信用卡每月还款提醒..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-22T04:05:15.000Z"}],["meta",{"property":"article:author","content":"EkkoSonya"}],["meta",{"property":"article:tag","content":"java_item"}],["meta",{"property":"article:published_time","content":"2025-11-21T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-22T04:05:15.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Javassm - item1-16 (订单定时 来单提醒 客户催单 1)\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-11-21T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-22T04:05:15.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"EkkoSonya\\",\\"url\\":\\"http://ekkosonya.cn\\"}]}"]]},"headers":[{"level":2,"title":"内容","slug":"内容","link":"#内容","children":[]},{"level":2,"title":"Spring Task","slug":"spring-task","link":"#spring-task","children":[{"level":3,"title":"应用场景","slug":"应用场景","link":"#应用场景","children":[]},{"level":3,"title":"cron表达式","slug":"cron表达式","link":"#cron表达式","children":[{"level":4,"title":"通配符","slug":"通配符","link":"#通配符","children":[]},{"level":4,"title":"cron表达式案例","slug":"cron表达式案例","link":"#cron表达式案例","children":[]}]},{"level":3,"title":"简单示例","slug":"简单示例","link":"#简单示例","children":[{"level":4,"title":"1. 导入maven坐标 spring-context","slug":"_1-导入maven坐标-spring-context","link":"#_1-导入maven坐标-spring-context","children":[]},{"level":4,"title":"2. 启动类添加注解开启任务调度 @EnableScheduling","slug":"_2-启动类添加注解开启任务调度-enablescheduling","link":"#_2-启动类添加注解开启任务调度-enablescheduling","children":[]},{"level":4,"title":"3.自定义定时任务类 @Scheduled","slug":"_3-自定义定时任务类-scheduled","link":"#_3-自定义定时任务类-scheduled","children":[]}]}]},{"level":2,"title":"订单状态定时处理","slug":"订单状态定时处理","link":"#订单状态定时处理","children":[{"level":3,"title":"需求分析","slug":"需求分析","link":"#需求分析","children":[]},{"level":3,"title":"代码开发","slug":"代码开发","link":"#代码开发","children":[]}]}],"git":{"createdTime":1763784315000,"updatedTime":1763784315000,"contributors":[{"name":"EkkoSonya","email":"ekkosonya@163.com","commits":1}]},"readingTime":{"minutes":4.02,"words":1205},"filePathRelative":"code/java_item/1-苍穹外卖/article16.md","localizedDate":"2025年11月21日","excerpt":"<h2>内容</h2>\\n<ul>\\n<li>Spring Task</li>\\n<li>订单状态定时处理</li>\\n<li>WebSocket</li>\\n<li>来单提醒</li>\\n<li>客户催单</li>\\n</ul>\\n<p>功能实现：<strong>订单状态定时处理</strong>、<strong>来单提醒</strong>和<strong>客户催单</strong></p>\\n<h2>Spring Task</h2>\\n<p><strong>Spring Task</strong> 是Spring框架提供的任务调度工具，可以按照约定的时间自动执行某个代码逻辑</p>\\n<p><strong>定位</strong>：定时任务框架</p>","autoDesc":true}')}}]);