"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[4382],{83671:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}},33770:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>i,data:()=>u});var t=a(7847);const e=a.p+"assets/img/68.7372360b.png",p=a.p+"assets/img/69.a9ed2ff3.png",o=a.p+"assets/img/70.2e201f1b.png",c=[(0,t.Fv)('<h2 id="内容" tabindex="-1"><a class="header-anchor" href="#内容"><span>内容</span></a></h2><ul><li>Apache ECharts</li><li>营业额统计</li><li>用户统计</li><li>订单统计</li><li>销量排名Top10</li></ul><p>功能实现：<strong>数据统计</strong></p><h2 id="订单统计" tabindex="-1"><a class="header-anchor" href="#订单统计"><span>订单统计</span></a></h2><p>订单统计通过一个折现图来展现，折线图上有两根线，这根蓝色的线代表的是订单总数，而下边这根绿色的线代表的是有效订单数，指的就是状态是已完成的订单就属于有效订单，分别反映的是每一天的数据。</p><figure><img src="'+e+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><p>上面还有3个数字，分别是订单总数、有效订单、订单完成率，它指的是整个时间区间之内总的数据。</p><h3 id="分析" tabindex="-1"><a class="header-anchor" href="#分析"><span>分析</span></a></h3><p><strong>业务规则</strong></p><ul><li>有效订单指状态为 “已完成” 的订单</li><li>基于可视化报表的折线图展示订单数据，X轴为日期，Y轴为订单数量</li><li>根据时间选择区间，展示每天的订单总数和有效订单数</li><li>展示所选时间区间内的有效订单数、总订单数、订单完成率，订单完成率 = 有效订单数 / 总订单数 * 100%</li></ul><h4 id="接口设计" tabindex="-1"><a class="header-anchor" href="#接口设计"><span>接口设计</span></a></h4><figure><img src="'+p+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><h3 id="代码开发" tabindex="-1"><a class="header-anchor" href="#代码开发"><span>代码开发</span></a></h3><h4 id="vo设计" tabindex="-1"><a class="header-anchor" href="#vo设计"><span>VO设计</span></a></h4><p>在sky-pojo模块，OrderReportVO.java已定义</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>\n<span class="token annotation punctuation">@Builder</span>\n<span class="token annotation punctuation">@NoArgsConstructor</span>\n<span class="token annotation punctuation">@AllArgsConstructor</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderReportVO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>\n\n    <span class="token comment">//日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> dateList<span class="token punctuation">;</span>\n\n    <span class="token comment">//每日订单数，以逗号分隔，例如：260,210,215</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> orderCountList<span class="token punctuation">;</span>\n\n    <span class="token comment">//每日有效订单数，以逗号分隔，例如：20,21,10</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> validOrderCountList<span class="token punctuation">;</span>\n\n    <span class="token comment">//订单总数</span>\n    <span class="token keyword">private</span> <span class="token class-name">Integer</span> totalOrderCount<span class="token punctuation">;</span>\n\n    <span class="token comment">//有效订单数</span>\n    <span class="token keyword">private</span> <span class="token class-name">Integer</span> validOrderCount<span class="token punctuation">;</span>\n\n    <span class="token comment">//订单完成率</span>\n    <span class="token keyword">private</span> <span class="token class-name">Double</span> orderCompletionRate<span class="token punctuation">;</span>\n\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="controller层" tabindex="-1"><a class="header-anchor" href="#controller层"><span>Controller层</span></a></h4><p><strong>在ReportController中根据订单统计接口创建orderStatistics方法</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 订单数据统计\n * <span class="token keyword">@param</span> <span class="token parameter">begin</span>\n * <span class="token keyword">@param</span> <span class="token parameter">end</span>\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/ordersStatistics&quot;</span><span class="token punctuation">)</span>\n<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;用户数据统计&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderReportVO</span><span class="token punctuation">&gt;</span></span> <span class="token function">orderStatistics</span><span class="token punctuation">(</span>\n        <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span>\n                <span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span>\n        <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span>\n                <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>\n\n    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>reportService<span class="token punctuation">.</span><span class="token function">getOrderStatistics</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service层" tabindex="-1"><a class="header-anchor" href="#service层"><span>Service层</span></a></h4><h5 id="接口" tabindex="-1"><a class="header-anchor" href="#接口"><span>接口</span></a></h5><p><strong>在ReportService接口中声明getOrderStatistics方法：</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n* 根据时间区间统计订单数量\n* <span class="token keyword">@param</span> <span class="token parameter">begin</span> \n* <span class="token keyword">@param</span> <span class="token parameter">end</span>\n* <span class="token keyword">@return</span> \n*/</span>\n<span class="token class-name">OrderReportVO</span> <span class="token function">getOrderStatistics</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span> <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="实现类" tabindex="-1"><a class="header-anchor" href="#实现类"><span>实现类</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 根据时间区间统计订单数量\n * <span class="token keyword">@param</span> <span class="token parameter">begin</span>\n * <span class="token keyword">@param</span> <span class="token parameter">end</span>\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token annotation punctuation">@Override</span>\n<span class="token keyword">public</span> <span class="token class-name">OrderReportVO</span> <span class="token function">getOrderStatistics</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span> <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LocalDate</span><span class="token punctuation">&gt;</span></span> dateList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    dateList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>begin<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        begin <span class="token operator">=</span> begin<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        dateList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//每天订单总数集合</span>\n    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> orderCountList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//每天有效订单数集合</span>\n    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> validOrderCountList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">LocalDate</span> date <span class="token operator">:</span> dateList<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token class-name">LocalDateTime</span> beginTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token class-name">LocalDateTime</span> endTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MAX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">//查询每天的总订单数 select count(id) from orders where order_time &gt; ? and order_time &lt; ?</span>\n        <span class="token class-name">Integer</span> orderCount <span class="token operator">=</span> <span class="token function">getOrderCount</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">,</span> endTime<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">//查询每天的有效订单数 select count(id) from orders where order_time &gt; ? and order_time &lt; ? and status = ?</span>\n        <span class="token class-name">Integer</span> validOrderCount <span class="token operator">=</span> <span class="token function">getOrderCount</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">,</span> endTime<span class="token punctuation">,</span> <span class="token class-name">Orders</span><span class="token punctuation">.</span><span class="token constant">COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        orderCountList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderCount<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        validOrderCountList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validOrderCount<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//时间区间内的总订单数</span>\n    <span class="token class-name">Integer</span> totalOrderCount <span class="token operator">=</span> orderCountList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//时间区间内的总有效订单数</span>\n    <span class="token class-name">Integer</span> validOrderCount <span class="token operator">=</span> validOrderCountList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//订单完成率</span>\n    <span class="token class-name">Double</span> orderCompletionRate <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span><span class="token punctuation">(</span>totalOrderCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        orderCompletionRate <span class="token operator">=</span> validOrderCount<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> totalOrderCount<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token class-name">OrderReportVO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">dateList</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dateList<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">orderCountList</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>orderCountList<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">validOrderCountList</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>validOrderCountList<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">totalOrderCount</span><span class="token punctuation">(</span>totalOrderCount<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">validOrderCount</span><span class="token punctuation">(</span>validOrderCount<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">orderCompletionRate</span><span class="token punctuation">(</span>orderCompletionRate<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token punctuation">}</span>\n\n<span class="token doc-comment comment">/**\n * 根据时间区间统计指定状态的订单数量\n * <span class="token keyword">@param</span> <span class="token parameter">beginTime</span>\n * <span class="token keyword">@param</span> <span class="token parameter">endTime</span>\n * <span class="token keyword">@param</span> <span class="token parameter">status</span>\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token keyword">private</span> <span class="token class-name">Integer</span> <span class="token function">getOrderCount</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span> beginTime<span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span> endTime<span class="token punctuation">,</span> <span class="token class-name">Integer</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;begin&quot;</span><span class="token punctuation">,</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> orderMapper<span class="token punctuation">.</span><span class="token function">countByMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mapper层" tabindex="-1"><a class="header-anchor" href="#mapper层"><span>Mapper层</span></a></h4><p><strong>在OrderMapper接口中声明countByMap方法</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n*根据动态条件统计订单数量\n* <span class="token keyword">@param</span> <span class="token parameter">map</span>\n*/</span>\n<span class="token class-name">Integer</span> <span class="token function">countByMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>在OrderMapper.xml文件中编写动态SQL</strong></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>countByMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n        select count(id) from orders\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>status != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n          and status = #{status}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>begin != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n          and order_time <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= #{begin}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>end != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n          and order_time <span class="token entity named-entity" title="&lt;">&amp;lt;</span>= #{end}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="销量排名统计" tabindex="-1"><a class="header-anchor" href="#销量排名统计"><span>销量排名统计</span></a></h2><p>所谓销量排名，销量指的是商品销售的数量。项目当中的商品主要包含两类：一个是<strong>套餐</strong>，一个是<strong>菜品</strong>，所以销量排名其实指的就是菜品和套餐销售的数量排名。</p><p>通过柱形图来展示销量排名，这些销量是按照降序来排列，并且只需要统计销量排名前十的商品</p><h3 id="分析-1" tabindex="-1"><a class="header-anchor" href="#分析-1"><span>分析</span></a></h3><p><strong>业务规则</strong></p><ul><li>根据时间选择区间，展示销量前10的商品（包括菜品和套餐）</li><li>基于可视化报表的柱状图降序展示商品销量</li><li>此处的销量为商品销售的份数</li></ul><h4 id="接口设计-1" tabindex="-1"><a class="header-anchor" href="#接口设计-1"><span>接口设计</span></a></h4><figure><img src="'+o+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><h3 id="代码开发-1" tabindex="-1"><a class="header-anchor" href="#代码开发-1"><span>代码开发</span></a></h3><h4 id="vo设计-1" tabindex="-1"><a class="header-anchor" href="#vo设计-1"><span>VO设计</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>\n<span class="token annotation punctuation">@Builder</span>\n<span class="token annotation punctuation">@NoArgsConstructor</span>\n<span class="token annotation punctuation">@AllArgsConstructor</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SalesTop10ReportVO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>\n\n    <span class="token comment">//商品名称列表，以逗号分隔，例如：鱼香肉丝,宫保鸡丁,水煮鱼</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> nameList<span class="token punctuation">;</span>\n\n    <span class="token comment">//销量列表，以逗号分隔，例如：260,215,200</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> numberList<span class="token punctuation">;</span>\n\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="controller层-1" tabindex="-1"><a class="header-anchor" href="#controller层-1"><span>Controller层</span></a></h4><p><strong>在ReportController中根据销量排名接口创建top10方法</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n* 销量排名统计\n* <span class="token keyword">@param</span> <span class="token parameter">begin</span>\n* <span class="token keyword">@param</span> <span class="token parameter">end</span>\n* <span class="token keyword">@return</span>\n*/</span>\n<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/top10&quot;</span><span class="token punctuation">)</span>\n<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;销量排名统计&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SalesTop10ReportVO</span><span class="token punctuation">&gt;</span></span> <span class="token function">top10</span><span class="token punctuation">(</span>\n    <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span> <span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span>\n    <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span> <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>reportService<span class="token punctuation">.</span><span class="token function">getSalesTop10</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service层-1" tabindex="-1"><a class="header-anchor" href="#service层-1"><span>Service层</span></a></h4><h5 id="接口-1" tabindex="-1"><a class="header-anchor" href="#接口-1"><span>接口</span></a></h5><p><strong>在ReportService接口中声明getSalesTop10方法</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n* 查询指定时间区间内的销量排名top10 \n* <span class="token keyword">@param</span> <span class="token parameter">begin</span>\n* <span class="token keyword">@param</span> <span class="token parameter">end</span>\n* <span class="token keyword">@return</span>\n*/</span>\n<span class="token class-name">SalesTop10ReportVO</span> <span class="token function">getSalesTop10</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span> <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="实现类-1" tabindex="-1"><a class="header-anchor" href="#实现类-1"><span>实现类</span></a></h5><p><strong>在ReportServiceImpl实现类中实现getSalesTop10方法</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 查询指定时间区间内的销量排名top10\n * <span class="token keyword">@param</span> <span class="token parameter">begin</span>\n * <span class="token keyword">@param</span> <span class="token parameter">end</span>\n * <span class="token keyword">@return</span>\n * */</span>\n<span class="token keyword">public</span> <span class="token class-name">SalesTop10ReportVO</span> <span class="token function">getSalesTop10</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span> <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token class-name">LocalDateTime</span> beginTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token class-name">LocalDateTime</span> endTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>end<span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MAX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GoodsSalesDTO</span><span class="token punctuation">&gt;</span></span> goodsSalesDTOList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getSalesTop10</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token class-name">String</span> nameList <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>goodsSalesDTOList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">GoodsSalesDTO</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token class-name">String</span> numberList <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>goodsSalesDTOList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">GoodsSalesDTO</span><span class="token operator">::</span><span class="token function">getNumber</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token class-name">SalesTop10ReportVO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">nameList</span><span class="token punctuation">(</span>nameList<span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">numberList</span><span class="token punctuation">(</span>numberList<span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mapper层-1" tabindex="-1"><a class="header-anchor" href="#mapper层-1"><span>Mapper层</span></a></h4><p><strong>在OrderMapper接口中声明getSalesTop10方法：</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n* 查询商品销量排名\n* <span class="token keyword">@param</span> <span class="token parameter">begin</span>\n* <span class="token keyword">@param</span> <span class="token parameter">end</span>\n*/</span>\n<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GoodsSalesDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSalesTop10</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span> begin<span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>在OrderMapper.xml文件中编写动态SQL：</strong></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getSalesTop10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.sky.dto.GoodsSalesDTO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  select od.name name,sum(od.number) number from order_detail od ,orders o\n  where od.order_id = o.id\n      and o.status = 5\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>begin != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n          and order_time <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= #{begin}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>end != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n          and order_time <span class="token entity named-entity" title="&lt;">&amp;lt;</span>= #{end}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n  group by name\n  order by number desc\n  limit 0, 10\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',56)],l={},i=(0,a(83671).A)(l,[["render",function(n,s){return(0,t.uX)(),(0,t.CE)("div",null,c)}]]),u=JSON.parse('{"path":"/code/java_item/1-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/article19.html","title":"Javassm - item1-19 (营业额|用户|订单统计2)","lang":"zh-CN","frontmatter":{"title":"Javassm - item1-19 (营业额|用户|订单统计2)","date":"2025-11-23T00:00:00.000Z","category":["code"],"tag":["java_item"],"order":-0.6,"description":"内容 Apache ECharts 营业额统计 用户统计 订单统计 销量排名Top10 功能实现：数据统计 订单统计 订单统计通过一个折现图来展现，折线图上有两根线，这根蓝色的线代表的是订单总数，而下边这根绿色的线代表的是有效订单数，指的就是状态是已完成的订单就属于有效订单，分别反映的是每一天的数据。 alt textalt text 上面还有3个数字...","head":[["meta",{"property":"og:url","content":"http://ekkosonya.cn/code/java_item/1-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/article19.html"}],["meta",{"property":"og:site_name","content":"EkkoSonya\'s Blog"}],["meta",{"property":"og:title","content":"Javassm - item1-19 (营业额|用户|订单统计2)"}],["meta",{"property":"og:description","content":"内容 Apache ECharts 营业额统计 用户统计 订单统计 销量排名Top10 功能实现：数据统计 订单统计 订单统计通过一个折现图来展现，折线图上有两根线，这根蓝色的线代表的是订单总数，而下边这根绿色的线代表的是有效订单数，指的就是状态是已完成的订单就属于有效订单，分别反映的是每一天的数据。 alt textalt text 上面还有3个数字..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-23T08:44:36.000Z"}],["meta",{"property":"article:author","content":"EkkoSonya"}],["meta",{"property":"article:tag","content":"java_item"}],["meta",{"property":"article:published_time","content":"2025-11-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-23T08:44:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Javassm - item1-19 (营业额|用户|订单统计2)\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-11-23T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-23T08:44:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"EkkoSonya\\",\\"url\\":\\"http://ekkosonya.cn\\"}]}"]]},"headers":[{"level":2,"title":"内容","slug":"内容","link":"#内容","children":[]},{"level":2,"title":"订单统计","slug":"订单统计","link":"#订单统计","children":[{"level":3,"title":"分析","slug":"分析","link":"#分析","children":[{"level":4,"title":"接口设计","slug":"接口设计","link":"#接口设计","children":[]}]},{"level":3,"title":"代码开发","slug":"代码开发","link":"#代码开发","children":[{"level":4,"title":"VO设计","slug":"vo设计","link":"#vo设计","children":[]},{"level":4,"title":"Controller层","slug":"controller层","link":"#controller层","children":[]},{"level":4,"title":"Service层","slug":"service层","link":"#service层","children":[{"level":5,"title":"接口","slug":"接口","link":"#接口","children":[]},{"level":5,"title":"实现类","slug":"实现类","link":"#实现类","children":[]}]},{"level":4,"title":"Mapper层","slug":"mapper层","link":"#mapper层","children":[]}]}]},{"level":2,"title":"销量排名统计","slug":"销量排名统计","link":"#销量排名统计","children":[{"level":3,"title":"分析","slug":"分析-1","link":"#分析-1","children":[{"level":4,"title":"接口设计","slug":"接口设计-1","link":"#接口设计-1","children":[]}]},{"level":3,"title":"代码开发","slug":"代码开发-1","link":"#代码开发-1","children":[{"level":4,"title":"VO设计","slug":"vo设计-1","link":"#vo设计-1","children":[]},{"level":4,"title":"Controller层","slug":"controller层-1","link":"#controller层-1","children":[]},{"level":4,"title":"Service层","slug":"service层-1","link":"#service层-1","children":[{"level":5,"title":"接口","slug":"接口-1","link":"#接口-1","children":[]},{"level":5,"title":"实现类","slug":"实现类-1","link":"#实现类-1","children":[]}]},{"level":4,"title":"Mapper层","slug":"mapper层-1","link":"#mapper层-1","children":[]}]}]}],"git":{"createdTime":1763887476000,"updatedTime":1763887476000,"contributors":[{"name":"EkkoSonya","email":"ekkosonya@163.com","commits":1}]},"readingTime":{"minutes":4.7,"words":1411},"filePathRelative":"code/java_item/1-苍穹外卖/article19.md","localizedDate":"2025年11月23日","excerpt":"<h2>内容</h2>\\n<ul>\\n<li>Apache ECharts</li>\\n<li>营业额统计</li>\\n<li>用户统计</li>\\n<li>订单统计</li>\\n<li>销量排名Top10</li>\\n</ul>\\n<p>功能实现：<strong>数据统计</strong></p>\\n<h2>订单统计</h2>\\n<p>订单统计通过一个折现图来展现，折线图上有两根线，这根蓝色的线代表的是订单总数，而下边这根绿色的线代表的是有效订单数，指的就是状态是已完成的订单就属于有效订单，分别反映的是每一天的数据。</p>\\n<figure><figcaption>alt text</figcaption></figure>","autoDesc":true}')}}]);