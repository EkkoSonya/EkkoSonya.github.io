"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[8248],{83671:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}},14688:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>l,data:()=>u});var t=a(7847);const e=a.p+"assets/img/53.c295656d.png",p=a.p+"assets/img/54.c5accf78.png",i=a.p+"assets/img/55.c88d92b9.png",c=[(0,t.Fv)('<h2 id="内容" tabindex="-1"><a class="header-anchor" href="#内容"><span>内容</span></a></h2><ul><li>缓存菜品</li><li>缓存套餐</li><li>添加购物车</li><li>查看购物车</li><li>清空购物车</li></ul><p>功能实现：<strong>缓存商品</strong>、<strong>购物车</strong></p><h2 id="添加购物车" tabindex="-1"><a class="header-anchor" href="#添加购物车"><span>添加购物车</span></a></h2><p>用户可以将菜品或者套餐添加到购物车</p><p>对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车;</p><p>对于套餐来说，可以直接点击 + 号将当前套餐加入购物车</p><p>在购物车中可以修改菜品和套餐的数量，也可以清空购物车</p><h3 id="接口设计" tabindex="-1"><a class="header-anchor" href="#接口设计"><span>接口设计</span></a></h3><p>对应的添加购物车接口 (这是加入购物车，所以一次是加入一个，不会同时存在dishId 和 setmealId)</p><figure><img src="'+e+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><h3 id="表设计" tabindex="-1"><a class="header-anchor" href="#表设计"><span>表设计</span></a></h3><p>用户的购物车数据，也是需要保存在数据库中的，购物车对应的数据表为shopping_cart表，具体表结构如下：</p><table><thead><tr><th><strong>字段名</strong></th><th><strong>数据类型</strong></th><th><strong>说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>主键</td><td>自增</td></tr><tr><td>name</td><td>varchar(32)</td><td>商品名称</td><td>冗余字段</td></tr><tr><td>image</td><td>varchar(255)</td><td>商品图片路径</td><td>冗余字段</td></tr><tr><td>user_id</td><td>bigint</td><td>用户id</td><td>逻辑外键</td></tr><tr><td>dish_id</td><td>bigint</td><td>菜品id</td><td>逻辑外键</td></tr><tr><td>setmeal_id</td><td>bigint</td><td>套餐id</td><td>逻辑外键</td></tr><tr><td>dish_flavor</td><td>varchar(50)</td><td>菜品口味</td><td></td></tr><tr><td>number</td><td>int</td><td>商品数量</td><td></td></tr><tr><td>amount</td><td>decimal(10,2)</td><td>商品单价</td><td>冗余字段</td></tr><tr><td>create_time</td><td>datetime</td><td>创建时间</td><td></td></tr></tbody></table><p><strong>说明</strong></p><ul><li>购物车数据是关联用户的，在表结构中，我们需要记录，每一个用户的购物车数据是哪些</li><li>菜品列表展示出来的既有套餐，又有菜品，如果用户选择的是套餐，就保存套餐ID(setmeal_id)，如果用户选择的是菜品，就保存菜品ID(dish_id)</li><li>对同一个菜品/套餐，如果选择多份不需要添加多条记录，增加数量number即可</li></ul><h3 id="代码开发" tabindex="-1"><a class="header-anchor" href="#代码开发"><span>代码开发</span></a></h3><h4 id="dto设计-shoppingcartdto" tabindex="-1"><a class="header-anchor" href="#dto设计-shoppingcartdto"><span>DTO设计 <code>ShoppingCartDTO</code></span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCartDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token class-name">Long</span> dishId<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token class-name">Long</span> setmealId<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> dishFlavor<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="controller层-shoppingcartcontroller" tabindex="-1"><a class="header-anchor" href="#controller层-shoppingcartcontroller"><span>Controller层 <code>ShoppingCartController</code></span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>\n<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/shoppingCart&quot;</span><span class="token punctuation">)</span>\n<span class="token annotation punctuation">@Slf4j</span>\n<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">&quot;C端购物车相关接口&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCartController</span> <span class="token punctuation">{</span>\n  <span class="token annotation punctuation">@Autowired</span>\n  <span class="token keyword">private</span> <span class="token class-name">ShoppingCartService</span> shoppingCartService<span class="token punctuation">;</span>\n\n  <span class="token doc-comment comment">/**\n   * 添加购物车\n   * <span class="token keyword">@param</span> <span class="token parameter">shoppingCartDTO</span>\n   * <span class="token keyword">@return</span>\n   */</span>\n  <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>\n  <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;添加购物车&quot;</span><span class="token punctuation">)</span>\n  <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ShoppingCartDTO</span> shoppingCartDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;添加购物车，商品信息为:{}&quot;</span><span class="token punctuation">,</span> shoppingCartDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shoppingCartService<span class="token punctuation">.</span><span class="token function">addShoppingCart</span><span class="token punctuation">(</span>shoppingCartDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service层接口-shoppingcartservice" tabindex="-1"><a class="header-anchor" href="#service层接口-shoppingcartservice"><span>Service层接口 <code>ShoppingCartService</code></span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ShoppingCartService</span> <span class="token punctuation">{</span>\n  <span class="token doc-comment comment">/**\n   * 添加购物车\n   * <span class="token keyword">@param</span> <span class="token parameter">shoppingCartDTO</span>\n   */</span>\n  <span class="token keyword">void</span> <span class="token function">addShoppingCart</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCartDTO</span> shoppingCartDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service层实现类-shoppingcartserviceimpl" tabindex="-1"><a class="header-anchor" href="#service层实现类-shoppingcartserviceimpl"><span>Service层实现类 <code>ShoppingCartServiceImpl</code></span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCartServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ShoppingCartService</span> <span class="token punctuation">{</span>\n\n  <span class="token annotation punctuation">@Autowired</span>\n  <span class="token keyword">private</span> <span class="token class-name">ShoppingCartMapper</span> shoppingCartMapper<span class="token punctuation">;</span>\n\n  <span class="token annotation punctuation">@Autowired</span>\n  <span class="token keyword">private</span> <span class="token class-name">SetmealMapper</span> setmealMapper<span class="token punctuation">;</span>\n\n  <span class="token annotation punctuation">@Autowired</span>\n  <span class="token keyword">private</span> <span class="token class-name">DishMapper</span> dishMapper<span class="token punctuation">;</span>\n\n  <span class="token annotation punctuation">@Override</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addShoppingCart</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCartDTO</span> shoppingCartDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n      <span class="token class-name">ShoppingCart</span> shoppingCart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>shoppingCartDTO<span class="token punctuation">,</span> shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 获取用户user_id</span>\n      shoppingCart<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token class-name">BaseContext</span><span class="token punctuation">.</span><span class="token function">getCurrentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 判断当前加入到购物车的商品是否已经存在</span>\n      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingCart</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> shoppingCartMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 如果存在，直接数量加一</span>\n      <span class="token keyword">if</span><span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          shoppingCart <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          shoppingCart<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span>shoppingCart<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          shoppingCartMapper<span class="token punctuation">.</span><span class="token function">updateNumberById</span><span class="token punctuation">(</span>shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>\n          <span class="token comment">// 不存在 需要插入数据</span>\n          <span class="token class-name">Long</span> dishId <span class="token operator">=</span> shoppingCartDTO<span class="token punctuation">.</span><span class="token function">getDishId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span><span class="token punctuation">(</span>dishId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token comment">//添加到购物车的是菜品</span>\n              <span class="token class-name">Dish</span> dish <span class="token operator">=</span> dishMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dishId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n              shoppingCart<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>dish<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              shoppingCart<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>dish<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              shoppingCart<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span>dish<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>\n              <span class="token comment">//添加到购物车的是套餐</span>\n              <span class="token class-name">Setmeal</span> setmeal <span class="token operator">=</span> setmealMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>shoppingCartDTO<span class="token punctuation">.</span><span class="token function">getSetmealId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              shoppingCart<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>setmeal<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              shoppingCart<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>setmeal<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              shoppingCart<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span>setmeal<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          shoppingCart<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          shoppingCart<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          shoppingCartMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mapper层-shoppingcartmapper" tabindex="-1"><a class="header-anchor" href="#mapper层-shoppingcartmapper"><span>Mapper层 <code>ShoppingCartMapper</code></span></a></h4><h5 id="mapper层接口" tabindex="-1"><a class="header-anchor" href="#mapper层接口"><span><code>Mapper</code>层接口</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>\n<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ShoppingCartMapper</span> <span class="token punctuation">{</span>\n  <span class="token doc-comment comment">/**\n   * 条件查询\n   *\n   * <span class="token keyword">@param</span> <span class="token parameter">shoppingCart</span>\n   * <span class="token keyword">@return</span>\n   */</span>\n  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingCart</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCart</span> shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token doc-comment comment">/**\n   * 更新商品数量\n   *\n   * <span class="token keyword">@param</span> <span class="token parameter">shoppingCart</span>\n   */</span>\n  <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update shopping_cart set number = #{number} where id = #{id}&quot;</span><span class="token punctuation">)</span>\n  <span class="token keyword">void</span> <span class="token function">updateNumberById</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCart</span> shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token doc-comment comment">/**\n   * 插入购物车数据\n   *\n   * <span class="token keyword">@param</span> <span class="token parameter">shoppingCart</span>\n   */</span>\n  <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into shopping_cart (name, user_id, dish_id, setmeal_id, dish_flavor, number, amount, image, create_time) &quot;</span> <span class="token operator">+</span>\n          <span class="token string">&quot; values (#{name},#{userId},#{dishId},#{setmealId},#{dishFlavor},#{number},#{amount},#{image},#{createTime})&quot;</span><span class="token punctuation">)</span>\n  <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCart</span> shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="创建shoppingcartmapper-xml" tabindex="-1"><a class="header-anchor" href="#创建shoppingcartmapper-xml"><span>创建ShoppingCartMapper.xml</span></a></h5><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>\n<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>\n        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.sky.mapper.ShoppingCartMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.sky.entity.ShoppingCart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n        select * from shopping_cart\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userId != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n                and user_id = #{userId}\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dishId != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n                and dish_id = #{dishId}\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>setmealId != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n                and setmeal_id = #{setmealId}\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dishFlavor != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n                and dish_flavor = #{dishFlavor}\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>\n        order by create_time asc\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看购物车" tabindex="-1"><a class="header-anchor" href="#查看购物车"><span>查看购物车</span></a></h2><p>当用户添加完菜品和套餐后，可进入到购物车中，查看购物中的菜品和套餐</p><h3 id="接口设计-get-user-shoppingcart-list" tabindex="-1"><a class="header-anchor" href="#接口设计-get-user-shoppingcart-list"><span>接口设计 <code>GET /user/shoppingCart/list</code></span></a></h3><figure><img src="'+p+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><h3 id="代码开发-1" tabindex="-1"><a class="header-anchor" href="#代码开发-1"><span>代码开发</span></a></h3><h4 id="controller层" tabindex="-1"><a class="header-anchor" href="#controller层"><span><code>Controller</code>层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>\n<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;查看购物车&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingCart</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getShoppingCarts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>shoppingCartService<span class="token punctuation">.</span><span class="token function">getShoppingCarts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service接口层" tabindex="-1"><a class="header-anchor" href="#service接口层"><span><code>Service</code>接口层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 查看购物车\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingCart</span><span class="token punctuation">&gt;</span></span> <span class="token function">getShoppingCarts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service实现层" tabindex="-1"><a class="header-anchor" href="#service实现层"><span><code>Service</code>实现层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 查看购物车\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token annotation punctuation">@Override</span>\n<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingCart</span><span class="token punctuation">&gt;</span></span> <span class="token function">getShoppingCarts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">BaseContext</span><span class="token punctuation">.</span><span class="token function">getCurrentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token class-name">ShoppingCart</span> shoppingCart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    shoppingCart<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> shoppingCartMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>shoppingCart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="清空购物车" tabindex="-1"><a class="header-anchor" href="#清空购物车"><span>清空购物车</span></a></h2><p>当点击清空按钮时，会把购物车中的数据全部清空</p><h3 id="接口设计-delete-user-shoppingcart-clean" tabindex="-1"><a class="header-anchor" href="#接口设计-delete-user-shoppingcart-clean"><span>接口设计 <code>DELETE /user/shoppingCART/clean</code></span></a></h3><figure><img src="'+i+'" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><h3 id="代码开发-2" tabindex="-1"><a class="header-anchor" href="#代码开发-2"><span>代码开发</span></a></h3><h4 id="controller层-1" tabindex="-1"><a class="header-anchor" href="#controller层-1"><span><code>Controller</code>层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 清空购物车\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/clean&quot;</span><span class="token punctuation">)</span>\n<span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;清空购物车&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n    shoppingCartService<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service接口层-1" tabindex="-1"><a class="header-anchor" href="#service接口层-1"><span><code>Service</code>接口层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code> <span class="token doc-comment comment">/**\n * 清空购物车\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token keyword">void</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="service实现层-1" tabindex="-1"><a class="header-anchor" href="#service实现层-1"><span><code>Service</code>实现层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 清空购物车\n * <span class="token keyword">@return</span>\n */</span>\n<span class="token annotation punctuation">@Override</span>\n<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">BaseContext</span><span class="token punctuation">.</span><span class="token function">getCurrentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    shoppingCartMapper<span class="token punctuation">.</span><span class="token function">deleteByUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mapper层" tabindex="-1"><a class="header-anchor" href="#mapper层"><span><code>Mapper</code>层</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**\n * 清空购物车\n * <span class="token keyword">@param</span> <span class="token parameter">userId</span>\n */</span>\n<span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">&quot;delete from shopping_cart where user_id = #{userId}&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">void</span> <span class="token function">deleteByUserId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',54)],o={},l=(0,a(83671).A)(o,[["render",function(n,s){return(0,t.uX)(),(0,t.CE)("div",null,c)}]]),u=JSON.parse('{"path":"/code/java_item/1-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/article13.html","title":"Javassm - item1-13 (缓存商品 + 购物车 2)","lang":"zh-CN","frontmatter":{"title":"Javassm - item1-13 (缓存商品 + 购物车 2)","date":"2025-11-14T00:00:00.000Z","category":["code"],"tag":["java_item"],"order":-0.6,"description":"内容 缓存菜品 缓存套餐 添加购物车 查看购物车 清空购物车 功能实现：缓存商品、购物车 添加购物车 用户可以将菜品或者套餐添加到购物车 对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车; 对于套餐来说，可以直接点击 + 号将当前套餐加入购物车 在购物车中可以修改菜品和套餐的数量，也可以清空购物车 接口设计 对应的添加购物车接口 (这是...","head":[["meta",{"property":"og:url","content":"http://ekkosonya.cn/code/java_item/1-%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/article13.html"}],["meta",{"property":"og:site_name","content":"EkkoSonya\'s Blog"}],["meta",{"property":"og:title","content":"Javassm - item1-13 (缓存商品 + 购物车 2)"}],["meta",{"property":"og:description","content":"内容 缓存菜品 缓存套餐 添加购物车 查看购物车 清空购物车 功能实现：缓存商品、购物车 添加购物车 用户可以将菜品或者套餐添加到购物车 对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车; 对于套餐来说，可以直接点击 + 号将当前套餐加入购物车 在购物车中可以修改菜品和套餐的数量，也可以清空购物车 接口设计 对应的添加购物车接口 (这是..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-18T05:40:26.000Z"}],["meta",{"property":"article:author","content":"EkkoSonya"}],["meta",{"property":"article:tag","content":"java_item"}],["meta",{"property":"article:published_time","content":"2025-11-14T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-18T05:40:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Javassm - item1-13 (缓存商品 + 购物车 2)\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-11-14T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-18T05:40:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"EkkoSonya\\",\\"url\\":\\"http://ekkosonya.cn\\"}]}"]]},"headers":[{"level":2,"title":"内容","slug":"内容","link":"#内容","children":[]},{"level":2,"title":"添加购物车","slug":"添加购物车","link":"#添加购物车","children":[{"level":3,"title":"接口设计","slug":"接口设计","link":"#接口设计","children":[]},{"level":3,"title":"表设计","slug":"表设计","link":"#表设计","children":[]},{"level":3,"title":"代码开发","slug":"代码开发","link":"#代码开发","children":[{"level":4,"title":"DTO设计 ShoppingCartDTO","slug":"dto设计-shoppingcartdto","link":"#dto设计-shoppingcartdto","children":[]},{"level":4,"title":"Controller层 ShoppingCartController","slug":"controller层-shoppingcartcontroller","link":"#controller层-shoppingcartcontroller","children":[]},{"level":4,"title":"Service层接口 ShoppingCartService","slug":"service层接口-shoppingcartservice","link":"#service层接口-shoppingcartservice","children":[]},{"level":4,"title":"Service层实现类 ShoppingCartServiceImpl","slug":"service层实现类-shoppingcartserviceimpl","link":"#service层实现类-shoppingcartserviceimpl","children":[]},{"level":4,"title":"Mapper层 ShoppingCartMapper","slug":"mapper层-shoppingcartmapper","link":"#mapper层-shoppingcartmapper","children":[{"level":5,"title":"Mapper层接口","slug":"mapper层接口","link":"#mapper层接口","children":[]},{"level":5,"title":"创建ShoppingCartMapper.xml","slug":"创建shoppingcartmapper-xml","link":"#创建shoppingcartmapper-xml","children":[]}]}]}]},{"level":2,"title":"查看购物车","slug":"查看购物车","link":"#查看购物车","children":[{"level":3,"title":"接口设计 GET /user/shoppingCart/list","slug":"接口设计-get-user-shoppingcart-list","link":"#接口设计-get-user-shoppingcart-list","children":[]},{"level":3,"title":"代码开发","slug":"代码开发-1","link":"#代码开发-1","children":[{"level":4,"title":"Controller层","slug":"controller层","link":"#controller层","children":[]},{"level":4,"title":"Service接口层","slug":"service接口层","link":"#service接口层","children":[]},{"level":4,"title":"Service实现层","slug":"service实现层","link":"#service实现层","children":[]}]}]},{"level":2,"title":"清空购物车","slug":"清空购物车","link":"#清空购物车","children":[{"level":3,"title":"接口设计 DELETE /user/shoppingCART/clean","slug":"接口设计-delete-user-shoppingcart-clean","link":"#接口设计-delete-user-shoppingcart-clean","children":[]},{"level":3,"title":"代码开发","slug":"代码开发-2","link":"#代码开发-2","children":[{"level":4,"title":"Controller层","slug":"controller层-1","link":"#controller层-1","children":[]},{"level":4,"title":"Service接口层","slug":"service接口层-1","link":"#service接口层-1","children":[]},{"level":4,"title":"Service实现层","slug":"service实现层-1","link":"#service实现层-1","children":[]},{"level":4,"title":"Mapper层","slug":"mapper层","link":"#mapper层","children":[]}]}]}],"git":{"createdTime":1763444426000,"updatedTime":1763444426000,"contributors":[{"name":"EkkoSonya","email":"ekkosonya@163.com","commits":1}]},"readingTime":{"minutes":3.78,"words":1135},"filePathRelative":"code/java_item/1-苍穹外卖/article13.md","localizedDate":"2025年11月14日","excerpt":"<h2>内容</h2>\\n<ul>\\n<li>缓存菜品</li>\\n<li>缓存套餐</li>\\n<li>添加购物车</li>\\n<li>查看购物车</li>\\n<li>清空购物车</li>\\n</ul>\\n<p>功能实现：<strong>缓存商品</strong>、<strong>购物车</strong></p>\\n<h2>添加购物车</h2>\\n<p>用户可以将菜品或者套餐添加到购物车</p>\\n<p>对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车;</p>\\n<p>对于套餐来说，可以直接点击 + 号将当前套餐加入购物车</p>\\n<p>在购物车中可以修改菜品和套餐的数量，也可以清空购物车</p>","autoDesc":true}')}}]);